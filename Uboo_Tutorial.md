# Recording file I/O operations #

Uboo allows to create a dump (in a single text command-separated file) of all file activity for a given process, this dump can be later used to replay the activity without needing the original executable or data to be available.

**uboo\_rec** uses _strace_ to trace specific system-calls, this is the only requirement for _uboo\_rec_ to work.

In order to trace a new process, specify the command using the **-c** option:

```
[shnavid@winsuxx tiboo]$ ./uboo_rec.py -c 'dd if=/dev/zero of=/tmp/testing123.bin bs=1M count=10'
no output file specified, using "appdump.txt".

10+0 records in
10+0 records out
/dev/pts/6
10485760 bytes (10 MB) copied, 0.0457815 s, 229 MB/s

15 files used, 55 operations captured.
```

This will produce a file (in this case called "appdump.txt") which contains a detailed dump of all file I/O generated by the process:

```
%cmdline
dd if=/dev/zero of=/tmp/testing123.bin bs=1M count=10
%dump
# timestamp,pid,syscall(args),return_value,time_elapsed
[...]
1214304881.745183,32220,open|/etc/ld.so.cache|O_RDONLY,4,0.000015
1214304881.746845,32220,close|4,0,0.000009
[...]
1214304881.750534,32220,open|/tmp/testing123.bin|O_WRONLY|O_CREAT|O_TRUNC|0666,1,0.000052
1214304881.750834,32220,read|0|...|1048576,1048576,0.000819
1214304881.751777,32220,write|1|...|1048576,1048576,0.014460
1214304881.766399,32220,read|0|...|1048576,1048576,0.000189
1214304881.766703,32220,write|1|...|1048576,1048576,0.002798
1214304881.769631,32220,read|0|...|1048576,1048576,0.000187
1214304881.769929,32220,write|1|...|1048576,1048576,0.002825
1214304881.772879,32220,read|0|...|1048576,1048576,0.000190
1214304881.773179,32220,write|1|...|1048576,1048576,0.002808
1214304881.776107,32220,read|0|...|1048576,1048576,0.000182
1214304881.776406,32220,write|1|...|1048576,1048576,0.002810
1214304881.779332,32220,read|0|...|1048576,1048576,0.000186
1214304881.779629,32220,write|1|...|1048576,1048576,0.002989
1214304881.782754,32220,read|0|...|1048576,1048576,0.000191
1214304881.783056,32220,write|1|...|1048576,1048576,0.003131
1214304881.786325,32220,read|0|...|1048576,1048576,0.000210
1214304881.786650,32220,write|1|...|1048576,1048576,0.002801
1214304881.789569,32220,read|0|...|1048576,1048576,0.000183
1214304881.789863,32220,write|1|...|1048576,1048576,0.003079
1214304881.793074,32220,read|0|...|1048576,1048576,0.000185
1214304881.793371,32220,write|1|...|1048576,1048576,0.002858
1214304881.796363,32220,close|0,0,0.000014
[...]
```

# Replaying file I/O operations #

Using **uboo\_replay**, this file could now be used to replay the same exact I/O operations:

```
[shnavid@winsuxx tiboo]$ ./uboo_replay.py -i appdump.txt 

Please specify a comma-separated list of file names to replay:

 - /dev/pts/6
 - /dev/zero
 - /etc/ld.so.cache
 - /lib64/libc.so.6
 - /lib64/libpthread.so.0
 - /lib64/librt.so.1
 - /tmp/testing123.bin
 - /usr/lib/locale/locale-archive
 - /usr/share/locale/en.UTF-8/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en.utf8/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en_US.UTF-8/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en_US.utf8/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en_US/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/locale.alias
```

Since we only care about replaying I/O on /tmp/testing123.bin, we will specify what files to consider using the **-p** switch:

```
[shnavid@winsuxx tiboo]$ ./uboo_replay.py -i appdump.txt -p /tmp
no working directory specified, using "/tmp/appreplay-4EmPjI".

Creating temporary files...
 - /tmp/testing123.bin -> /tmp/appreplay-4EmPjI/0_tmp.testing123.bin (0 bytes)
Done.

Would you like to flush the caches (y/n) ? y

This operation requires root root permissions, please enter your root password.

Flushing caches...
Password: 

spawning new process main
read_time(min/avg/max):-/-/- write_time(min/avg/max):-/-/-
read_time(min/avg/max):-/-/- write_time(min/avg/max):-/-/-
```