#summary Uboo - File activity dump and replay

= Recording file I/O operations =

Uboo allows to create a dump (in a single text command-separated file) of all file activity for a given process, this dump can be later used to replay the activity without needing the original executable or data to be available.

*uboo_rec* uses _strace_ to trace specific system-calls, this is the only requirement for _uboo_rec_ to work.

In order to trace a new process, specify the command using the *-c* option:

{{{
[shnavid@winsuxx tiboo]$ ./uboo_rec.py -c 'dd if=/dev/zero of=/tmp/testing123.bin bs=1M count=10'
no output file specified, using "appdump.txt".

10+0 records in
10+0 records out
/dev/pts/6
10485760 bytes (10 MB) copied, 0.0457815 s, 229 MB/s

15 files used, 55 operations captured.
}}}

This will produce a file (in this case called "appdump.txt") which contains a detailed dump of all file I/O generated by the process:

{{{
%cmdline
dd if=/dev/zero of=/tmp/testing123.bin bs=1M count=10
%dump
# timestamp,pid,syscall(args),return_value,time_elapsed
1214304881.745183,32220,open|/etc/ld.so.cache|O_RDONLY,4,0.000015
1214304881.746845,32220,close|4,0,0.000009
1214304881.747002,32220,open|/lib64/librt.so.1|O_RDONLY,4,0.000018
1214304881.747153,32220,read|4|...|832,832,0.000011
[...]
}}}

= Replaying file I/O operations =

This file could now be moved to a different system where "dd" is not even installed, and used to replay the same exact I/O operations:

{{{
[shnavid@winsuxx tiboo]$ ./uboo_replay.py -i appdump.txt 

Please specify a comma-separated list of file names to replay:

 - /dev/pts/6
 - /dev/zero
 - /etc/ld.so.cache
 - /lib64/libc.so.6
 - /lib64/libpthread.so.0
 - /lib64/librt.so.1
 - /tmp/testing123.bin
 - /usr/lib/locale/locale-archive
 - /usr/share/locale/en.UTF-8/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en.utf8/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en_US.UTF-8/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en_US.utf8/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/en_US/LC_MESSAGES/coreutils.mo
 - /usr/share/locale/locale.alias
}}}

Since we only care about replaying I/O on /tmp/testing123.bin, we will specify what files to consider using the *-p* switch:

{{{
[shnavid@winsuxx tiboo]$ ./uboo_replay.py -i appdump.txt -p /tmp
no working directory specified, using "/tmp/appreplay-4EmPjI".

Creating temporary files...
 - /tmp/testing123.bin -> /tmp/appreplay-4EmPjI/0_tmp.testing123.bin (0 bytes)
Done.

Would you like to flush the caches (y/n) ? y

This operation requires root root permissions, please enter your root password.

Flushing caches...
Password: 

spawning new process main
read_time(min/avg/max):-/-/- write_time(min/avg/max):-/-/-
read_time(min/avg/max):-/-/- write_time(min/avg/max):-/-/-
}}}